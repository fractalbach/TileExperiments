"use strict";var ws,game={fetcher:{},Atlas:{},LogicalMap:{},TILE_SIZE:64,BLOCK_SIZE:960,TILES_PER_BLOCK:15,VIEWPORT_TILE_WIDTH:45,VIEWPORT_TILE_HEIGHT:45,classes:{net:{}},toolkit:{},enums:{GROUND_LAYER:0,ABOVE_LAYER:1},MY_USER:"user"+new Date().getTime().toString().slice(-7,-2)};console.log("init done");
"use strict";game.main=function(){for(var a,b=["net","player","camera","drawer","debug","interact"],c=0;c<b.length;c++)a=b[c],game[a].init();game.drawer.DrawMap(),game.net.ws.conn.addEventListener("open",function(){ws("add",game.MY_USER),ws("move",game.MY_USER,2,8),ws("list")})},window.addEventListener("load",function(){console.log("window loaded"),game.fetcher.FetchMap(game.fetcher.DEFAULT)});
"use strict";{var setFirstTile=function(a,b){FirstTile.X=a,FirstTile.Y=b},getMinX=function(){return FirstTile.X},getMinY=function(){return FirstTile.Y},getMaxX=function(){return FirstTile.X+game.VIEWPORT_TILE_WIDTH},getMaxY=function(){return FirstTile.Y+game.VIEWPORT_TILE_HEIGHT},center=function(){var a=ScrollableViewport.innerWidth,b=ScrollableViewport.innerHeight,c=3*game.BLOCK_SIZE/2-a/2,d=3*game.BLOCK_SIZE/2-b/2;ScrollableViewport.scrollTo(c,d)},scrollToTile=function(c,a){var b=ScrollableViewport.clientWidth,d=ScrollableViewport.clientHeight,e=(c-FirstTile.X)*game.TILE_SIZE-b/2,f=(a-FirstTile.Y)*game.TILE_SIZE-d/2;ScrollableViewport.scrollTo(e,f)},getTileCenterCoords=function(c,a){return{x:(c-FirstTile.X+.5)*game.TILE_SIZE,y:(a-FirstTile.Y+.5)*game.TILE_SIZE}},getTileTopLeft=function(c,a){return{left:(c-FirstTile.X)*game.TILE_SIZE,top:(a-FirstTile.Y)*game.TILE_SIZE}},isTileVisible=function(a,b){return a>getMinX()&&a<getMaxX()&&b>getMinY()&&b<getMaxY()},init=function(){},FirstTile={X:0,Y:0},ScrollableViewport=document.querySelector("#GameViewport");game.camera={init:init,FirstTile:FirstTile,setFirstTile:setFirstTile,getMinX:getMinX,getMinY:getMinY,getMaxX:getMaxX,getMaxY:getMaxY,scrollToTile:scrollToTile,getTileCenterCoords:getTileCenterCoords,getTileTopLeft:getTileTopLeft,ScrollableViewport:ScrollableViewport,isTileVisible:isTileVisible}}
"use strict";function _slicedToArray(a,b){return _arrayWithHoles(a)||_iterableToArrayLimit(a,b)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!(b&&c.length===b));d=!0);}catch(a){e=!0,f=a}finally{try{d||null==h["return"]||h["return"]()}finally{if(e)throw f}}return c}function _arrayWithHoles(a){if(Array.isArray(a))return a}{var CatImageLoaded=function(){return new Promise(function(a){CatImage.onload=a})},getName=function(a,b,c){return"STANDING"==b?"".concat(a,"_STANDING"):"WALKING"==b&&0==c?"".concat(a,"_STANDING"):"".concat(a,"_").concat(b,"_").concat(c)},getValues=function(a,b,c){var d=ANIMATIONS[getName(a,b,c)];if(d==null)throw new Error("Invalid animation.");var e=d[0]*SPOT_SIZE,f=d[1]*SPOT_SIZE;return[e,f]},draw=function(a,b,c,d){CatImageLoaded().then(_draw(a,b,c,d))},_draw=function(a,b,c,d){a.clearRect(0,0,game.TILE_SIZE,game.TILE_SIZE);var e=getValues(b,c,d),f=_slicedToArray(e,2),g=f[0],h=f[1];a.drawImage(CatImage,g,h,SPOT_SIZE,SPOT_SIZE,0,0,game.TILE_SIZE,game.TILE_SIZE)},sayHurray=function(){console.log("cat image already loaded, do draw!")},filename="img/catsprite.png",CatImage=new Image;CatImage.src=filename;var ANIMATIONS={S_WALKING_1:[0,0],S_STANDING:[1,0],S_WALKING_2:[2,0],SW_WALKING_1:[3,0],SW_STANDING:[4,0],SW_WALKING_2:[5,0],S_JUMPING_1:[6,0],S_JUMPING_2:[7,0],W_WALKING_1:[0,1],W_STANDING:[1,1],W_WALKING_2:[2,1],NW_WALKING_1:[3,1],NW_STANDING:[4,1],NW_WALKING_2:[5,1],W_JUMPING_1:[6,1],W_JUMPING_2:[7,1],E_WALKING_1:[0,2],E_STANDING:[1,2],E_WALKING_2:[2,2],SE_WALKING_1:[3,2],SE_STANDING:[4,2],SE_WALKING_2:[5,2],E_JUMPING_1:[6,2],E_JUMPING_2:[7,2],N_WALKING_1:[0,2],N_STANDING:[1,2],N_WALKING_2:[2,2],NE_WALKING_1:[3,2],NE_STANDING:[4,2],NE_WALKING_2:[5,2],N_JUMPING_1:[6,3],N_JUMPING_2:[7,3],N_SLEEPING_0:[0,4],N_SLEEPING_1:[1,4],N_SLEEPING_2:[2,4],SE_SITTING_0:[3,4],SE_SITTING_1:[4,4],S_SLEEPING_0:[0,5],S_SLEEPING_1:[1,5],S_SLEEPING_2:[3,5]},SPOT_SIZE=32,_exports={TheCat:{draw:draw}};Object.assign(game,_exports)}
"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}{var lolz=function(){var a=["omg, wat.","hello there!","why am I a red square?","hey, you look like me!","what's going on here?"],b=[],c=0,d=!0,e=!1,f=void 0;try{for(var g,h,j=game.player.list.keys()[Symbol.iterator]();!(d=(g=j.next()).done);d=!0)h=g.value,c++,c<a.length&&ws("chat",h,a[c]),b.push(h)}catch(a){e=!0,f=a}finally{try{d||null==j.return||j.return()}finally{if(e)throw f}}return b},ChatBox=function(){function a(){_classCallCheck(this,a),this.element=game.toolkit.MakeElement("div",{class:"chatbox"},"#WrapChat"),this.duration=1e4,this.timebomb(),this.CurrentPos={X:-1,Y:-1}}return _createClass(a,[{key:"setPos",value:function c(a,b){this.CurrentPos.X=a,this.CurrentPos.Y=b,this.draw()}},{key:"draw",value:function g(){var a=this.CurrentPos,b=a.X,c=a.Y,d=game.camera.getTileCenterCoords(b,c),e=d.x,f=d.y;f-=game.TILE_SIZE/2,this.element.style.top="calc(".concat(f,"px - 1em"),this.element.style.left="calc(".concat(e,"px - 33ch)")}},{key:"setText",value:function b(a){this.element.textContent=a}},{key:"doMessage",value:function b(a){this.setText(a),window.clearTimeout(this.timer),this.timebomb()}},{key:"timebomb",value:function b(){var a=this;this.timer=window.setTimeout(function(){a.clear()},this.duration)}},{key:"remove",value:function a(){this.element.remove()}},{key:"clear",value:function a(){this.element.textContent=""}}]),a}();game.chat={ChatBox:ChatBox,lolz:lolz}}
"use strict";game.debug={init:function a(){},OutlineMiddleTile:function i(a,b){var c=a.width,d=a.height,e=c/2-c/2%b,f=d/2-d/2%b,g=a.getContext("2d"),h=g.fillStyle;g.fillStyle="rgba(255, 0, 0, 0.4)",g.strokeRect(e,f,b-1,b-1),g.fillRect(e,f,b-1,b-1),g.fillStyle=h}};
"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}{var init=function(){for(var a=0;a<NUM_ROWS;a++)for(var g=0;g<NUM_COLS;g++){for(var b=g*TILES_PER_BLOCK,c=a*TILES_PER_BLOCK,d=[],e=WRAP.children[a].children[g],f=0;f<NUM_LAYERS;f++)d.push(e.children[f]);var h=new game.classes.MapBlock(d,b,c,TILES_PER_BLOCK,TILES_PER_BLOCK);blocklist.push(h),game.drawer.GridOfMapBlocks.Add(a,g,h)}},GetMapBlockElement=function(a,b){var c=WRAP.getElementsByClassName("row")[b];return c.getElementsByClassName("block")[a]},DrawMap=function(){for(var a,b=0;b<blocklist.length;b++)a=blocklist[b],a.FullDraw()},calcNextFirstTile=function(a,b){var c=game.camera.FirstTile,d=c.X,e=c.Y;return d+=a*TILES_PER_BLOCK,e+=b*TILES_PER_BLOCK,{X:d,Y:e}},updateFirstTileByFactor=function(a,b){var c=calcNextFirstTile(a,b),d=c.X,e=c.Y;game.camera.setFirstTile(d,e)},ShiftDown=function(){var a=document.querySelector("#VisualMap"),b=a.scrollTop;row0=WRAP.getElementsByClassName("row")[0],WRAP.appendChild(row0),updateFirstTileByFactor(0,1),game.player.DrawAll();var c=game.drawer.GridOfMapBlocks.ShiftDown(),d=2*TILES_PER_BLOCK+game.camera.FirstTile.Y,e=!0,f=!1,g=void 0;try{for(var h,j=c.keys()[Symbol.iterator]();!(e=(h=j.next()).done);e=!0)i=h.value,c[i].RedefineAndDraw(c[i].tx0,d)}catch(a){f=!0,g=a}finally{try{e||null==j.return||j.return()}finally{if(f)throw g}}console.log(game.drawer.GridOfMapBlocks),a.scrollTop=b-game.BLOCK_SIZE},ShiftUp=function(){calcNextFirstTile(0,-1)},ShiftLeft=function(){calcNextFirstTile(-1,0)},ShiftRight=function(){calcNextFirstTile(1,0)},NUM_ROWS=3,NUM_COLS=3,NUM_LAYERS=2,blocklist=[],WRAP=document.querySelector("#VisualMap"),TILES_PER_BLOCK=Math.floor(game.BLOCK_SIZE/game.TILE_SIZE);game.drawer={init:init,blocklist:blocklist,DrawMap:DrawMap,GetMapBlockElement:GetMapBlockElement,ShiftDown:ShiftDown,ShiftUp:ShiftUp,ShiftLeft:ShiftLeft,ShiftRight:ShiftRight,TILES_PER_BLOCK:TILES_PER_BLOCK}}{var MapBlock=function(){function a(b,c,d,e,f){_classCallCheck(this,a),this.canvasList=b,this.ctxList=[];var g=!0,h=!1,j=void 0;try{for(var k,l,m=b[Symbol.iterator]();!(g=(k=m.next()).done);g=!0)l=k.value,this.ctxList.push(l.getContext("2d"))}catch(a){h=!0,j=a}finally{try{g||null==m.return||m.return()}finally{if(h)throw j}}this.tx0=c,this.ty0=d,this.tw=e,this.th=f,this.txf=c+e,this.tyf=d+f}return _createClass(a,[{key:"Clear",value:function j(){var a=!0,b=!1,d=void 0;try{for(var e,f=this.canvasList.keys()[Symbol.iterator]();!(a=(e=f.next()).done);a=!0){var g=e.value,h=this.canvasList[g],c=this.ctxList[g];c.clearRect(0,0,h.width,h.height)}}catch(a){b=!0,d=a}finally{try{a||null==f.return||f.return()}finally{if(b)throw d}}}},{key:"FullDraw",value:function a(){this.DrawLayer(game.enums.GROUND_LAYER),this.DrawLayer(game.enums.ABOVE_LAYER)}},{key:"DrawLayer",value:function g(a){for(var h=0;h<this.th;h++)for(var j=0;j<this.tw;j++){var b=this.tx0+j,c=this.ty0+h,d=j*game.TILE_SIZE,e=h*game.TILE_SIZE,f=game.GetMapTile(b,c);void 0!==f&&f.draw(this.ctxList[a],a,d,e)}}},{key:"RedefineAndDraw",value:function c(a,b){this.tx0=a,this.ty0=b,this.txf=this.tx0+this.tw,this.tyf=this.ty0+this.th,this.Clear(),this.FullDraw()}}]),a}();game.classes.MapBlock=MapBlock}{for(var Add=function(a,b,c){m[a][b]=c},SwapRows=function(a,b){var c=m[a];m[a]=m[b],m[b]=c},SwapCols=function(a,b){var c=!0,d=!1,e=void 0;try{for(var f,g=m.keys()[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var h=f.value,j=m[h][a];m[h][a]=m[h][b],m[h][b]=j}}catch(a){d=!0,e=a}finally{try{c||null==g.return||g.return()}finally{if(d)throw e}}},GetCol=function(a){var b=[],c=!0,d=!1,e=void 0;try{for(var f,g,h=m.keys()[Symbol.iterator]();!(c=(f=h.next()).done);c=!0)g=f.value,b.push(m[g][a])}catch(a){d=!0,e=a}finally{try{c||null==h.return||h.return()}finally{if(d)throw e}}return b},GetRow=function(a){return m[a]},_ShiftDown=function(){return SwapRows(0,2),SwapRows(0,1),m[2]},_ShiftUp=function(){return SwapRows(0,2),SwapRows(0,1),m[0]},_ShiftLeft=function(){return SwapCols(0,2),SwapCols(0,1),GetCol(0)},_ShiftRight=function(){return SwapCols(0,2),SwapCols(1,2),GetCol(2)},m=[,,,],row=0;3>row;row++)m[row]=[,,,];game.drawer.GridOfMapBlocks={m:m,Add:Add,ShiftDown:_ShiftDown,ShiftUp:_ShiftUp,ShiftLeft:_ShiftLeft,ShiftRight:_ShiftRight,GetRow:GetRow,GetCol:GetCol}}
"use strict";game.fetcher={FIRST_DONE:!1,JSON_URLS:{1:"json/example.json",2:"tools/ex.json",3:"tools/hundred.json"},DEFAULT:"tools/hundred.json",FetchMap:function c(a){var b=this;console.log("Fetching map from: ".concat(a)),fetch(a).then(function(a){return a.json()}).then(function(a){b.handleJson(a)}).catch(function(a){console.error("Fetch Error:",a)})},handleJson:function b(a){console.log("FetchMap Completed:",a),game.Atlas=a.Atlas,game.LogicalMap=a.Map,this.MakeMapIntoTileMatrix(),this.FetchAtlasImage(game.Atlas.ImagePath)},FetchAtlasImage:function b(a){a=window.location+"img/tiles.png",console.log("Fetching image from: ".concat(a)),game.AtlasImage=new Image,game.AtlasImage.src="img/tiles.png",game.AtlasImage.addEventListener("load",this.TriggerDraw,!1)},TriggerDraw:function a(){return!0===this.FIRST_DONE?void game.drawer.DrawMap():void(this.FIRST_DONE=!0,console.log("Image Fetch Done:",game.AtlasImage),game.main())},MakeMapIntoTileMatrix:function k(){var a=game.LogicalMap.Height,b=game.LogicalMap.Width,c=Array(a),d=!0,e=!1,f=void 0;try{for(var g,h,j=c.keys()[Symbol.iterator]();!(d=(g=j.next()).done);d=!0)h=g.value,c[h]=Array(b)}catch(a){e=!0,f=a}finally{try{d||null==j.return||j.return()}finally{if(e)throw f}}for(var l=0;l<a;l++)for(var m,n=0;n<b;n++)m=new game.classes.Tile(n,l),m.layers[game.enums.GROUND_LAYER]=game.LogicalMap.Data[0][l][n],m.layers[game.enums.ABOVE_LAYER]=game.LogicalMap.Data[1][l][n],c[l][n]=m;game.TileMatrix=c,game.GetMapTile=function(c,d){return c>=b||d>=a?void 0:game.TileMatrix[d][c]}}};
"use strict";{var init=function(){overlay.addEventListener("click",handleClickEvent)},handleClickEvent=function(a){var b=Math.floor,c=overlay.getBoundingClientRect(),d=a.clientX-c.left,e=a.clientY-c.top,f=b(d/game.TILE_SIZE),g=b(e/game.TILE_SIZE),h=game.camera.FirstTile.X+f,i=game.camera.FirstTile.Y+g;ws("move",game.MY_USER,h,i),game.player.me().setTarget(h,i),game.player.DrawTargetBox()},overlay=document.querySelector("#Overlay"),clickbox=document.querySelector("#myclickbox");game.interact={init:init,overlay:overlay,handleClickEvent:handleClickEvent,clickbox:clickbox}}
"use strict";function _slicedToArray(a,b){return _arrayWithHoles(a)||_iterableToArrayLimit(a,b)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!(b&&c.length===b));d=!0);}catch(a){e=!0,f=a}finally{try{d||null==h["return"]||h["return"]()}finally{if(e)throw f}}return c}function _arrayWithHoles(a){if(Array.isArray(a))return a}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}{var WebSocketHub=function(){function a(b){_classCallCheck(this,a),this.conn=new WebSocket(b),this.conn.onopen=a.DefaultHandleOpen,this.conn.onclose=a.DefaultHandleClose,this.conn.onmessage=a.DefaultHandleMessage,this.uid=123}return _createClass(a,[{key:"nextId",value:function b(){++this.uid;var a=this.uid;return a}},{key:"send",value:function i(a){for(var b=[],c=arguments.length,d=Array(1<c?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];for(var f,g=0;g<d.length;g++)f=d[g],b.push(f);var h=JSON.stringify({method:a,params:b});this.conn.send(h)}}],[{key:"DefaultHandleOpen",value:function b(a){console.log("Connection Opened: ".concat(a.currentTarget.url))}},{key:"DefaultHandleClose",value:function b(a){console.log("Connection Closed: ".concat(a.currentTarget.url))}},{key:"DefaultHandleMessage",value:function e(b){for(var c=b.data.split("\n"),d=0;d<c.length;d++)a.HandleJSONMessage(c[d])}},{key:"HandleJSONMessage",value:function c(a){var b=JSON.parse(a);game.net.HandleMessage(b)}}]),a}();game.classes.net.WebSocketHub=WebSocketHub,ws=function f(a){for(var b,c=arguments.length,d=Array(1<c?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];return(b=game.net.ws).send.apply(b,[a].concat(d))};var wsreset=function(){game.net.ws.conn.addEventListener("close",function(){game.net.StartLocal()}),game.net.ws.conn.close()}}game.net={init:function a(){this.ws=this.ConnectTo(this.DEFAULT_SERVER)},DEFAULT_SERVER:new URL("wss://thebachend.com/ws/echo"),ConnectTo:function b(a){if(window.WebSocket)return new game.classes.net.WebSocketHub(a);throw new Error("Cannot connect to Websocket at ".concat(a))},DEFAULT_LOCAL_SERVER:new URL("ws://".concat(window.location.hostname,":8090/ws/echo")),StartLocal:function a(){return this.ws=this.ConnectTo(this.DEFAULT_LOCAL_SERVER),game.net.ws.conn.addEventListener("open",function(){ws("add",game.MY_USER),ws("move",game.MY_USER,2,8),ws("list")}),this.ws}};{var HandleIncomingMessage=function(a){if(void 0!==a.kind){var b=funcMap[a.kind];if("function"!=typeof b)throw new Error("message kind not implemented: ".concat(a.kind));b(a)}},handlePlayerList=function(a){game.player.UpdateList(a.result)},handleUpdateTargets=function(a){for(var b=Object.entries(a.result),c=0;c<b.length;c++){var d=_slicedToArray(b[c],2),e=d[0],f=d[1];game.player.list2[e].TargetPos=f}},handleChat=function(a){console.log(a);var b=a.result,c=b.User,d=b.Message;game.player.playermap.get(c).chatbox.setText(d)},funcMap={playerlist:handlePlayerList,UpdateTargets:handleUpdateTargets,chat:handleChat};game.net.HandleMessage=HandleIncomingMessage}{var submitChat=function(){return!!chatbar.value&&!!game.net.ws.conn&&(ws("chat",game.MY_USER,chatbar.value),chatbar.value="",chatbar.blur(),!1)},chatbar=document.querySelector("#ChatBar"),chatform=document.querySelector("#ChatInputForm");chatform.onsubmit=submitChat}
"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _slicedToArray(a,b){return _arrayWithHoles(a)||_iterableToArrayLimit(a,b)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!(b&&c.length===b));d=!0);}catch(a){e=!0,f=a}finally{try{d||null==h["return"]||h["return"]()}finally{if(e)throw f}}return c}function _arrayWithHoles(a){if(Array.isArray(a))return a}{var init=function(){},me=function(){return game.player.playermap.get(game.MY_USER)},UpdateList=function(a){activeset.clear();for(var b=Object.entries(a),c=0;c<b.length;c++){var d=_slicedToArray(b[c],2),e=d[0],f=d[1];playermap.has(e)||playermap.set(e,game.classes.Player.New(e));var m=playermap.get(e);{var g=f.CurrentPos,h=g.X,i=g.Y;m.setPos(h,i)}{var j=f.TargetPos,k=j.X,l=j.Y;m.setTarget(k,l)}m.Draw(),activeset.add(e)}this.Refresh()},Refresh=function(){var a=!0,b=!1,c=void 0;try{for(var d,e,f=playermap.keys()[Symbol.iterator]();!(a=(d=f.next()).done);a=!0)e=d.value,activeset.has(e)?activeset.delete(e):(playermap.get(e).canvas.remove(),playermap.get(e).chatbox.remove(),playermap.delete(e))}catch(a){b=!0,c=a}finally{try{a||null==f.return||f.return()}finally{if(b)throw c}}},DrawAll=function(){var a=!0,b=!1,c=void 0;try{for(var d,e,f=playermap[Symbol.iterator]();!(a=(d=f.next()).done);a=!0)e=_slicedToArray(d.value,2),name=e[0],p=e[1],p.Draw()}catch(a){b=!0,c=a}finally{try{a||null==f.return||f.return()}finally{if(b)throw c}}DrawTargetBox()},DrawTargetBox=function(){var a=game.player.me().TargetPos,b=a.X,c=a.Y,d=game.player.me().CurrentPos,e=d.X,f=d.Y;if(e==b&&f==c)return void targetbox.style.setProperty("display","none");if(!game.camera.isTileVisible(b,c))return void targetbox.style.setProperty("display","none");var g=game.camera.getTileTopLeft(b,c),h=g.top,i=g.left;targetbox.style.top=h+"px",targetbox.style.left=i+"px",targetbox.style.setProperty("display","")},playermap=new Map,activeset=new Set,targetbox=document.querySelector("#myclickbox");game.player={me:me,playermap:playermap,init:init,UpdateList:UpdateList,Refresh:Refresh,DrawAll:DrawAll,DrawTargetBox:DrawTargetBox}}{var Player=function(){function a(b,c){_classCallCheck(this,a),this.name=c,this.canvas=b,this.ctx=b.getContext("2d"),this.CurrentPos={X:1,Y:1},this.TargetPos={X:1,Y:1},this.chatbox=new game.chat.ChatBox,this.chatbox.setText(this.name)}return _createClass(a,[{key:"setPos",value:function c(a,b){this.CurrentPos={X:a,Y:b},this.chatbox.setPos(a,b)}},{key:"setTarget",value:function c(a,b){this.TargetPos={X:a,Y:b}}},{key:"Draw",value:function g(){var a=this.CurrentPos,b=a.X,c=a.Y;if(!game.camera.isTileVisible(b,c))return void this.canvas.style.setProperty("display","none");var d=game.camera.getTileTopLeft(b,c),e=d.top,f=d.left;this.canvas.style.setProperty("top","".concat(e,"px")),this.canvas.style.setProperty("left","".concat(f,"px")),this.canvas.style.setProperty("display","")}},{key:"scrollTo",value:function d(){var a=this.CurrentPos,b=a.X,c=a.Y;game.camera.scrollToTile(b,c)}}],[{key:"New",value:function k(b){for(var c=document.createElement("canvas"),d={width:game.TILE_SIZE,height:game.TILE_SIZE,class:"player"},e=Object.entries(d),f=0;f<e.length;f++){var g=_slicedToArray(e[f],2),h=g[0],i=g[1];c.setAttribute(h,i)}document.querySelector("#WrapPlayerLayer").appendChild(c);var j=new a(c,b);return game.TheCat.draw(j.ctx,"W","JUMPING",2),game.player.playermap.set(b,j),j}}]),a}();game.classes.Player=Player}
"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}{var Tile=function(){function a(b,c){_classCallCheck(this,a),this.x=b,this.y=c,this.layers={}}return _createClass(a,[{key:"isEmpty",value:function b(a){return 0===this.layers[a]||void 0===this.layers[a]}},{key:"getAtlasLocation",value:function c(a){var b=this.layers[a];return{x:(b-1)%game.Atlas.ImageCols*game.Atlas.TileWidth,y:Math.floor((b-1)/game.Atlas.ImageCols)*game.Atlas.TileHeight}}},{key:"draw",value:function f(a,b,c,d){if(!this.isEmpty(b)){var e=this.getAtlasLocation(b);a.drawImage(game.AtlasImage,e.x,e.y,game.Atlas.TileWidth,game.Atlas.TileHeight,c,d,game.TILE_SIZE,game.TILE_SIZE)}}}]),a}();game.classes.Tile=Tile}
"use strict";function _typeof(a){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _slicedToArray(a,b){return _arrayWithHoles(a)||_iterableToArrayLimit(a,b)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!(b&&c.length===b));d=!0);}catch(a){e=!0,f=a}finally{try{d||null==h["return"]||h["return"]()}finally{if(e)throw f}}return c}function _arrayWithHoles(a){if(Array.isArray(a))return a}{var TimeBomb=function(a,b){window.setTimeout(function(){a.remove()},b)},MakeElement=function(a,b,c){var d=document.createElement(a);if(b!==void 0)for(var e=Object.entries(b),f=0;f<e.length;f++){var g=_slicedToArray(e[f],2),h=g[0],i=g[1];d.setAttribute(h,i)}if(void 0!==c)switch(_typeof(c)){case"object":c.appendChild(d);case"string":document.querySelector(c).appendChild(d);}return d};game.toolkit=Object.assign({TimeBomb:TimeBomb,MakeElement:MakeElement},game.toolkit)}

//# sourceMappingURL=game.js.map