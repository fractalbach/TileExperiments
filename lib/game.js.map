{"version":3,"sources":["../src/init.js","../src/main.js","../src/stuff/camera.js","../src/stuff/chat.js","../src/stuff/debug.js","../src/stuff/drawer.js","../src/stuff/fetcher.js","../src/stuff/interact.js","../src/stuff/net/websock.js","../src/stuff/player.js","../src/stuff/tiles.js","../src/stuff/toolkit/elements.js"],"names":[],"mappings":"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","file":"game.js","sourcesContent":["// ================================================\n// Init Game Object\n// ------------------------------------------------\nvar game = {\n\n    // Fetcher is used for downloading map data.\n    fetcher: {},\n\n    // Atlas: the source image for the visual tiles\n    Atlas: {},\n\n    // LogicalMap: contains data for types of tile.\n    LogicalMap: {},\n\n    // Magic Variables\n    TILE_SIZE: 64,\n    BLOCK_SIZE: 960,\n\n    // Holds class definitions\n    classes: {\n        net: {},\n    },\n\n    // toolkit holds helper functions\n    toolkit: {},\n\n    // Global Enum Values.\n    enums: {\n        GROUND_LAYER: 0,\n        ABOVE_LAYER: 1,\n    },\n\n    // Default Player Username\n    MY_USER: \"user\" + (new Date()).getTime().toString().slice(-7, -2)\n\n}\n\nvar ws\n\nconsole.log(\"init done\")\n","// ================================================\n// Main\n// ------------------------------------------------\ngame.main = (event)=>{\n\n    // Call the init() function on each of the libraries.\n    // Display to console for debugging.\n\n    let LibList = ['net', 'player', 'camera', 'drawer', 'debug', 'interact']\n\n    for (let lib of LibList) {\n        game[lib].init()\n        // console.log(`$ game.${lib}`, game[lib])\n    }\n\n    game.drawer.DrawMap()\n    // console.log(\"$ game \\n\", game)\n    \n    game.net.ws.conn.addEventListener('open', ()=>{    \n        ws('add', game.MY_USER)\n        ws('move', game.MY_USER, 2, 8)\n        ws('list')\n    })\n}\n\n// Start the Fetcher When the Page has loaded.\n// The fetcher will call game.main() when the maps have \n// been fetched, and the images have been loaded.\nwindow.addEventListener(\"load\", ()=>{\n    console.log(\"window loaded\")\n    game.fetcher.FetchMap(game.fetcher.DEFAULT)\n}\n);\n\n// This should be the last .js file to be listed in the html,\n// which means it should be the last one to load.\n// Check that all definitions have been loaded:\n\n// console.log(\"$ game.classes \\n\", game.classes)\n","// ================================================\n// Camera\n// ------------------------------------------------\n\n/*\nThe camera will remain seperate from the player's position.  In this\nversion of the game, the camera is actually determined by the player's\nposition, but that will be kept seperate from the class definitions.\n\nThe Camera determines the tiles that are visible at any given point\nin time, and generates iterators for use by the Renderer.\n*/\n{\n    // The tile where the camera is centered.\n    //     let position = {\n    //         x: 10,\n    //         y: 10\n    //     }\n\n    // The radius (in tiles) around which everything is visible.\n    // NOTE: For now, this will not be a circle radius, and instead\n    // will be the the side length of a square.\n    //     let VIEW_RADIUS = 10\n\n    // The TileLocation of the Tile that is currently at square (0,0).\n    // This can be negative if the camera is near the edge of the map.\n    let FirstTile = {\n        x: 0,\n        y: 0\n    }\n\n    function setFirstTile(X, Y) {\n        FirstTile = {\n            x: X,\n            y: Y,\n        }\n    }\n\n    // Scrollable Viewport Element\n    // The element that can actually be manipulated using the \n    // scrollTo command.  Originally, this was just the window,\n    // but as the HTML structure changes, this element might change.\n    let ScrollableViewport = document.querySelector('#GameViewport')\n\n    // Rectangle Bounds. camera position.\n    //     function UpdateBounds() {\n    //         this.x0 = position.x - VIEW_RADIUS\n    //         this.xf = position.x + VIEW_RADIUS\n    //         this.y0 = position.y - VIEW_RADIUS\n    //         this.yf = position.y + VIEW_RADIUS\n    //     }\n\n    // VisibleTiles Generates an Iterator of TileLocations.\n    // Later on, this function will accept parameters that define the\n    // shape of the visual area (for example, a Circle instead of a Rectangle).\n    //     function *VisibleTiles() {\n    //         for (let x = this.x0; x < this.xf; x++) {\n    //             for (let y = this.y0; y < this.yf; y++) {\n    //                 yield({\n    //                     x,\n    //                     y\n    //                 })\n    //             }\n    //         }\n    //     }\n\n    // Scrolls such that the absolute center tile is displayed in the center \n    // of the screen.\n    function center() {\n        let w = ScrollableViewport.innerWidth\n        let h = ScrollableViewport.innerHeight\n        let x = game.BLOCK_SIZE * 3 / 2 - w / 2\n        let y = game.BLOCK_SIZE * 3 / 2 - h / 2\n        ScrollableViewport.scrollTo(x, y)\n    }\n\n    // Scrolls such that the specified tile becomes visible\n    // at the center of the screen.\n    function scrollToTile(a, b) {\n        let w = ScrollableViewport.clientWidth\n        let h = ScrollableViewport.clientHeight\n        let x = (a - FirstTile.x) * game.TILE_SIZE - w / 2\n        let y = (b - FirstTile.y) * game.TILE_SIZE - h / 2\n        ScrollableViewport.scrollTo(x, y)\n    }\n\n    // getTileCenterCoords returns the pixel location of the center \n    // of the specified tile.\n    function getTileCenterCoords(a, b) {\n        return {\n            x: (a - FirstTile.x + 0.5) * game.TILE_SIZE,\n            y: (b - FirstTile.y + 0.5) * game.TILE_SIZE,\n        }\n    }\n\n    // returns the upper-left corner of a tile, which is useful for\n    // setting styles like \"top\" and \"left\"\n    function getTileTopLeft(a, b) {\n        return {\n            left: (a - FirstTile.x) * game.TILE_SIZE,\n            top: (b - FirstTile.y) * game.TILE_SIZE,\n        }\n    }\n\n    function init() {\n    }\n\n    game.camera = {\n        init,\n        FirstTile,\n        setFirstTile,\n        scrollToTile,\n        getTileCenterCoords,\n        getTileTopLeft,\n        ScrollableViewport,\n    }\n}\n","// ================================================\n// In-game Chat\n// -----------------------------------------------\n\n// document.styleSheets[0].cssRules[0]\n\n{\n    // stores the mapping of (username -> chatmessage)\n    let _chatmap = new Map()\n\n    // Creates a new chatbox. It's message can be changed later.\n    class ChatBox {\n        constructor() {\n            // the div element that holds the text.\n            this.element = game.toolkit.MakeElement('div', {\n                class: \"chatbox\",\n            }, '#WrapChat')\n\n            // duration is the amount of time before the chat\n            // message gets cleared.\n            this.duration = 10000\n\n            // Start off the chat timebomb (which clears the chat)\n            this.timebomb()\n        }\n\n        // setPos places the div element containing the text at a location\n        // that keeps the text centered at that tile.\n        setPos(tx, ty) {\n            let {x, y} = game.camera.getTileCenterCoords(tx, ty)\n            //x += game.TILE_SIZE / 2\n            y -= game.TILE_SIZE / 2\n            this.element.style.top = `calc(${y}px - 1em`\n            this.element.style.left = `calc(${x}px - 33ch)`\n        }\n\n        setText(text) {\n            this.element.textContent = text\n        }\n\n        // doMessage is called by the chat message handler and adds\n        // a timer to the text.  It clears previous timers, to prevent \n        // multiple timers from existing at the same time.\n        doMessage(text) {\n            this.setText(text)\n            window.clearTimeout(this.timer)\n            this.timebomb()\n        }\n\n        // Timebomb creates a new timer that will clear the chat \n        // after some pre-specfied amount of time.\n        timebomb() {\n            this.timer = window.setTimeout(()=>{\n                this.clear()\n            }\n            , this.duration)\n        }\n\n        remove() {\n            this.element.remove()\n        }\n\n        clear() {\n            this.element.textContent = \"\"\n        }\n\n    }\n\n    function lolz() {\n        let examples = ['omg, wat.', 'hello there!', 'why am I a red square?', 'hey, you look like me!', \"what's going on here?\"]\n        let l = []\n        let i = 0\n        for (let name of game.player.list.keys()) {\n            i++\n            if (i < examples.length) {\n                ws('chat', name, examples[i])\n            }\n            l.push(name)\n        }\n        return l\n    }\n\n    game.chat = {\n        ChatBox,\n        lolz\n    }\n}\n","// ================================================\n// Canvas Debugging Tools\n// ------------------------------------------------\n\ngame.debug = {\n\n    init() {},\n\n    // Draws an outine around the tile that is closest to the middle.  The\n    // location of the middle of each tile is used in the calculation.  Works\n    // for Square Tiles where TilSize is the length of a side.\n    OutlineMiddleTile(Canvas, TileSize) {\n        let w = Canvas.width\n        let h = Canvas.height\n        let x = (w / 2) - ((w / 2) % TileSize)\n        let y = (h / 2) - ((h / 2) % TileSize)\n\n        let ctx = Canvas.getContext('2d')\n        let saved = ctx.fillStyle\n        ctx.fillStyle = 'rgba(255, 0, 0, 0.4)'\n        ctx.strokeRect(x, y, TileSize - 1, TileSize - 1)\n        ctx.fillRect(x, y, TileSize - 1, TileSize - 1)\n        ctx.fillStyle = saved\n    }\n}\n","// ================================================\n// Drawer  \n// ------------------------------------------------\n\n// {\n//   it's the kind of drawer that draws,\n//    but since it's pretty much a variable,\n//    you can also put things in it.  \n//\n//     So I guess it's a drawer filled with \n//      shelves of drawing functions.\n// }\n\n// TODO: Rename/Move this file to game.graphics.mapblock\n\n{\n    // rows of mapblocks in visual map\n    const NUM_ROWS = 3\n\n    // columns of mapblocks in visual map.\n    const NUM_COLS = 3\n\n    // layers per mapblock \n    const NUM_LAYERS = 2\n\n    // Create a blocklist, which holds all of the mapblocks.\n    // add references to the relevent canvases,\n    // and calculate the tiles they hold.\n    let blocklist = []\n\n    // The element that holds the map-related canvases \n    const WRAP = document.querySelector(`#VisualMap`)\n\n    // Calculate the side length of a MapBlock, in units of TILES.\n    let TILES_PER_BLOCK = Math.floor(game.BLOCK_SIZE / game.TILE_SIZE)\n\n    function init() {\n\n        // Width and Height of the mapblock will be the same,\n        // since the MapBlocks are squares. \n        let tw = TILES_PER_BLOCK\n        let th = TILES_PER_BLOCK\n\n        for (let row = 0; row < NUM_ROWS; row++) {\n            for (let col = 0; col < NUM_COLS; col++) {\n\n                // The starting positions are defined in a special way \n                // because of the placement of the blocks (3 columns).\n                // this will change when the positioning changes. \n                let tx0 = col * TILES_PER_BLOCK\n                let ty0 = row * TILES_PER_BLOCK\n\n                // Add the canvas list (each of the layers).\n                let canvasList = []\n\n                // Get the div element that holds the canvases\n                let blockElement = WRAP.children[row].children[col]\n\n                // Iterate through the layers to retrieve the canvas elements.\n                for (let layer = 0; layer < NUM_LAYERS; layer++) {\n                    canvasList.push(blockElement.children[layer])\n                }\n\n                // Create the MapBlock object.\n                let block = new game.classes.MapBlock(canvasList,tx0,ty0,tw,th)\n\n                // TODO: replace blocklist with GridOfMapBlocks\n                //\n                // add it to the blocklist. \n                blocklist.push(block)\n\n                // Add the MapBlock to the GridOfMapBlocks\n                game.drawer.GridOfMapBlocks.Add(row,col,block)\n            }\n        }\n    }\n\n    // Retrieves the MapBlock element based on the position.\n    function GetMapBlockElement(col, row) {\n        let ROW = WRAP.getElementsByClassName('row')[row]\n        return ROW.getElementsByClassName('block')[col]\n    }\n\n    // DrawMap() is called by the fetcher!\n    // TODO: split data, For each BLOCK, draw that portion of the map.\n    function DrawMap() {\n        for (let mapblock of blocklist) {\n            mapblock.FullDraw()\n        }\n    }\n\n    // calc Next First Tile is a helper function to determine what\n    // the new \"FirstTile\" of the visual screen is 'logically'.\n    // \n    // factorX, factorY should be -1, 0, or 1\n    //\n    // In the future, this can become more sophisicated, and include\n    // things like checks for world boundary limits.\n    //\n    function calcNextFirstTile(factorX, factorY) {\n        let {x: X, y: Y} = game.camera.FirstTile\n        X += factorX * TILES_PER_BLOCK\n        Y += factorY * TILES_PER_BLOCK\n        return {\n            X,\n            Y\n        }\n    }\n\n    // This is basically just an extention of the calcNextFirstTile\n    // function, but it actually changes the FirstTile.\n    function updateFirstTileByFactor(factorX, factorY) {\n        let {X, Y} = calcNextFirstTile(factorX, factorY)\n        game.camera.setFirstTile(X, Y)\n    }\n\n    function ShiftDown() {\n\n        // scroll to keep the same tile in view.\n        let v = document.querySelector('#GameViewport')\n        let savedView = v.scrollTop\n\n        // move the DOM elements around.\n        row0 = WRAP.getElementsByClassName('row')[0]\n        WRAP.appendChild(row0)\n\n        // update the camera variables\n        updateFirstTileByFactor(0, 1)\n\n        // Redraw players and stuff.\n        game.player.DrawAll()\n\n        // Swap the logical mapblocks,\n        // Calculate the new position of the first tile in each block. \n        // Redefine the mapblock and redraw it.\n        //\n        let arr = game.drawer.GridOfMapBlocks.ShiftDown()\n        let newY = 2*TILES_PER_BLOCK + game.camera.FirstTile.y\n        for (i of arr.keys()) {\n            arr[i].RedefineAndDraw(arr[i].tx0, newY)\n        }\n        console.log(game.drawer.GridOfMapBlocks)\n        v.scrollTop = savedView - game.BLOCK_SIZE\n\n    }\n\n    function ShiftUp() {\n        calcNextFirstTile(0, -1)\n    }\n\n    function ShiftLeft() {\n        calcNextFirstTile(-1, 0)\n\n    }\n\n    function ShiftRight() {\n        calcNextFirstTile(1, 0)\n    }\n\n    game.drawer = {\n        init,\n        blocklist,\n        DrawMap,\n        GetMapBlockElement,\n        ShiftDown,\n        ShiftUp,\n        ShiftLeft,\n        ShiftRight,\n        TILES_PER_BLOCK,\n    }\n}\n\n// ================================================\n// Class MapBlock  \n// ------------------------------------------------\n{\n    // The MapBlock class will be added to game.defs, but will mainly be\n    // used by the game.drawer and game.camera functions.\n    class MapBlock {\n        constructor(canvasList, tx0, ty0, tw, th) {\n\n            // The canvas list is an array of canvas elements, each one of them\n            // refers to the same area of visual space, at different layers.\n            // the 0th entry in this array is the ground: the first to be drawn.\n            this.canvasList = canvasList\n            this.ctxList = []\n\n            // keep references to each MapBlock's canvas.\n            for (let canvas of canvasList) {\n                this.ctxList.push(canvas.getContext('2d'))\n            }\n\n            // the rectangle defines the portion of the overall map.\n            // the mapblock is like a chunk of that map, and its bounds are\n            // defined using a rectangle.\n            // (the unit is tiles)\n            this.tx0 = tx0\n            this.ty0 = ty0\n            this.tw = tw\n            this.th = th\n            this.txf = tx0 + tw\n            this.tyf = ty0 + th\n        }\n\n        Clear() {\n            for (let i of this.canvasList.keys()) {\n                let c = this.canvasList[i]\n                let ctx = this.ctxList[i]\n                ctx.clearRect(0, 0, c.width, c.height)\n            }\n        }\n\n        FullDraw() {\n            this.DrawLayer(game.enums.GROUND_LAYER)\n            this.DrawLayer(game.enums.ABOVE_LAYER)\n        }\n\n        DrawLayer(layer) {\n            for (let row = 0; row < this.th; row++) {\n                for (let col = 0; col < this.tw; col++) {\n                    let tx = this.tx0 + col\n                    let ty = this.ty0 + row\n                    let px = col * game.TILE_SIZE\n                    let py = row * game.TILE_SIZE\n                    let tile = game.GetMapTile(tx, ty)\n                    if (tile !== undefined) {\n                        tile.draw(this.ctxList[layer], layer, px, py)\n                    }\n                }\n            }\n        }\n\n        // RedefineAndDraw assigns new bounds to the MapBlock, clears it,\n        // then redraws it. This is primarily used when using one of the \n        // Shift functions.\n        //\n        // X and Y refer to the first logical tile within the MapBlock.\n        // Everything else will be updated accordingly.\n        RedefineAndDraw(X, Y) {\n            this.tx0 = X\n            this.ty0 = Y\n            this.txf = this.tx0 + this.tw\n            this.tyf = this.ty0 + this.th\n            this.Clear()\n            this.FullDraw()\n        }\n    }\n    game.classes.MapBlock = MapBlock\n}\n\n// ================================================\n// GridOfMapBlocks  \n// ------------------------------------------------\n\n{\n    // GridOfMapBlocks is a 2-d array of MapBlock objects.\n    // The configuration of this grid should match the visual one\n    // in the DOM. \n\n    let m = new Array(3)\n    for (let row = 0; row < 3; row++) {\n        m[row] = new Array(3)\n    }\n\n    function Add(A, B, thing) {\n        m[A][B] = thing \n    }\n\n    function SwapRows(A, B) {\n        let saved = m[A]\n        m[A] = m[B]\n        m[B] = saved\n    }\n\n    function SwapCols(A, B) {\n        for (let row of m.keys()) {\n            let saved = m[row][A]\n            m[row][A] = m[row][B]\n            m[row][B] = saved\n        }\n    }\n\n    // Returns an array of the  in the column.\n    function GetCol(A) {\n        let out = []\n        for (let row of m.keys()) {\n            out.push(m[row][A])\n        }\n        return out\n    }\n\n    function GetRow(A) {\n        return m[A]\n    }\n\n    // The Shift functions will move the rows & columsn around,\n    // and return a list of the elements that were \n    // 'shifted off the edge'.\n    // \n    // Basically, you want to redraw each of those mapblocks,\n    // and can do so using a for-of loop.\n    //\n\n    function ShiftDown() {\n        SwapRows(0, 2)\n        SwapRows(0, 1)\n        return m[2]\n    }\n\n    function ShiftUp() {\n        SwapRows(0, 2)\n        SwapRows(0, 1)\n        return m[0]\n    }\n\n    function ShiftLeft() {\n        SwapCols(0, 2)\n        SwapCols(0, 1)\n        return GetCol(0)\n    }\n\n    function ShiftRight() {\n        SwapCols(0, 2)\n        SwapCols(1, 2)\n        return GetCol(2)\n    }\n\n    game.drawer.GridOfMapBlocks = {\n        m,\n        Add,\n        ShiftDown,\n        ShiftUp,\n        ShiftLeft,\n        ShiftRight,\n        GetRow,\n        GetCol,\n    }\n}\n","// ================================================\n// Fetcher: Downloading Map Data\n// ------------------------------------------------\n\n// Default Locations for fetching the Map Data.\ngame.fetcher = {\n\n    // Keeps track of the initial map fetch.\n    FIRST_DONE: false,\n\n    // URLs of various different experimental maps.\n    JSON_URLS: {\n        1: \"json/example.json\",\n        2: \"tools/ex.json\",\n        3: \"tools/hundred.json\",\n    },\n\n    // The Default map to load for FetchMap() \n    DEFAULT: window.location.href + \"tools/hundred.json\",\n\n    // TODO: return a Promise that the image will load,\n    //       then do a .then(DrawMap())\n    //\n    FetchMap(map_url) {\n        console.log(`Fetching map from: ${map_url}`)\n        fetch(map_url).then((response)=>{\n            return response.json()\n        }\n        ).then((myJson)=>{\n            this.handleJson(myJson)\n        }\n        ).catch(error=>{\n            console.error('Fetch Error:', error)\n        }\n        )\n    },\n\n    // handleJson basically just saves the json data into memory.\n    handleJson(myJson) {\n        console.log(\"FetchMap Completed:\", myJson)\n\n        // add the JSON data to the game.\n        game.Atlas = myJson.Atlas\n        game.LogicalMap = myJson.Map\n\n        // Prepare the TileMatrix\n        this.MakeMapIntoTileMatrix()\n\n        // Fetch and Load the image for the atlas.\n        this.FetchAtlasImage(game.Atlas.ImagePath)\n\n    },\n\n    FetchAtlasImage(path) {\n\n        // TODO: make json into relative paths.\n        path = window.location + \"img/tiles.png\"\n\n        console.log(`Fetching image from: ${path}`)\n\n        // Once the image has been fetched and loaded, the map can be drawn.\n        game.AtlasImage = new Image()\n        game.AtlasImage.src = \"img/tiles.png\"\n        game.AtlasImage.addEventListener('load', this.TriggerDraw, false)\n\n    },\n\n    TriggerDraw() {\n        // If this is not the initial fetch, just draw the map.\n        if (this.FIRST_DONE === true) {\n            game.drawer.DrawMap()\n            return\n        }\n        // Call the \"main\" function if this is the first fetch.\n        this.FIRST_DONE = true\n        console.log(`Image Fetch Done:`, game.AtlasImage)\n        game.main()\n    },\n\n    MakeMapIntoTileMatrix() {\n\n        // Create a matrix of Tiles, based on the LogicalMap of values.\n        // Basically, converts the values into Tile objects that can be used later.\n        let h = game.LogicalMap.Height\n        let w = game.LogicalMap.Width\n\n        // Create an empty (w x h) matrix.\n        let matrix = new Array(h)\n        for (let i of matrix.keys()) {\n            matrix[i] = new Array(w)\n        }\n\n        for (let row = 0; row < h; row++) {\n            for (let col = 0; col < w; col++) {\n\n                // Create the Tile.\n                let t = new game.classes.Tile(col,row)\n\n                // Assign layer information\n                // TODO!!\n                // Change the JSON format, then change this!\n                t.layers[game.enums.GROUND_LAYER] = game.LogicalMap.Data[0][row][col]\n                t.layers[game.enums.ABOVE_LAYER] = game.LogicalMap.Data[1][row][col]\n\n                // Save the tile into the TileMatrix.\n                matrix[row][col] = t\n\n            }\n        }\n        // Save the filled matrix into an accessible location.\n        game.TileMatrix = matrix\n        // Helper function for retrieving map tiles.\n        game.GetMapTile = (tx,ty)=>{\n            if ((tx >= w) || (ty >= h)) {\n                return undefined\n            }\n            return game.TileMatrix[ty][tx]\n        }\n    },\n\n}\n","// ================================================\n// User Interactions and Event Handlers\n// ------------------------------------------------\n{\n    // The overlay canvas is what the user actually clicks on.\n    // Keep this as a variable, because the specific canvas\n    // element may change in the future.\n    let overlay = document.querySelector('#Overlay')\n\n    // The clickbox is a fancy extra box that it used to show you\n    // that you have clicked on a tile.\n    let clickbox = document.querySelector('#myclickbox')\n\n    function init() {\n        overlay.addEventListener('click', handleClickEvent)\n    }\n\n    function handleClickEvent(event) {\n\n        // Get the clicked (x,y) relative to the canvas element.        \n        let r = overlay.getBoundingClientRect();\n        let x = event.clientX - r.left\n        let y = event.clientY - r.top\n\n        // offset pixel position of target tile's upper-left corner.\n        // used for adding the target canvas.\n        //\n        // TODO: this should just update targetbox location and redraw it.\n        //\n        {\n            let left = x - (x % game.TILE_SIZE)\n            let top = y - (y % game.TILE_SIZE)\n            clickbox.style.top = top + 'px'\n            clickbox.style.left = left + 'px'\n        }\n        // The Tile(x,y) relative to the first tile on the board.\n        let OffsetTileX = Math.floor(x / game.TILE_SIZE)\n        let OffsetTileY = Math.floor(y / game.TILE_SIZE)\n\n        // Calculate the actual tile.\n        let outx = game.camera.FirstTile.x + OffsetTileX\n        let outy = game.camera.FirstTile.y + OffsetTileY\n\n        ws('move', game.MY_USER, outx, outy)\n        // Debug Message\n        // console.log(`you clicked on tile (${outx}, ${outy})`)\n    }\n\n    game.interact = {\n        init,\n        overlay,\n        handleClickEvent,\n        clickbox,\n    }\n}\n","// ================================================\n// Websockets \n// ------------------------------------------------\n\n{\n    class WebSocketHub {\n        constructor(address) {\n            this.conn = new WebSocket(address);\n            this.conn.onopen = WebSocketHub.DefaultHandleOpen\n            this.conn.onclose = WebSocketHub.DefaultHandleClose;\n            this.conn.onmessage = WebSocketHub.DefaultHandleMessage;\n            this.uid = 123\n        }\n\n        static DefaultHandleOpen(evt) {\n            console.log(`Connection Opened: ${evt.currentTarget.url}`)\n        }\n\n        static DefaultHandleClose(evt) {\n            console.log(`Connection Closed: ${evt.currentTarget.url}`)\n        }\n\n        static DefaultHandleMessage(evt) {\n            let messages = evt.data.split('\\n');\n            for (let i = 0; i < messages.length; i++) {\n                WebSocketHub.HandleJSONMessage(messages[i])\n            }\n        }\n\n        static HandleJSONMessage(IncomingMessage) {\n            let msg = JSON.parse(IncomingMessage)\n            // msg.TIME = new Date(msg.time).toTimeString()\n            // console.log(msg)\n            game.net.HandleMessage(msg)\n        }\n\n        nextId() {\n            this.uid = this.uid + 1\n            let copy = this.uid\n            return copy\n        }\n\n        send(MessageString, ...params) {\n            // Increment the id counter so we can match up the message.\n            // let id = this.nextId()\n\n            // Convert the parameters into an array\n            let Parameters = []\n            for (let p of params) {\n                Parameters.push(p)\n            }\n\n            // Convert into a JSON message, according to the server APIs.\n            let msg = JSON.stringify({\n                // id: id,\n                method: MessageString,\n                params: Parameters,\n                //time: (new Date()).getTime(),\n            });\n\n            // Send the JSON message across the websocket.\n            this.conn.send(msg);\n            return\n        }\n    }\n    game.classes.net.WebSocketHub = WebSocketHub\n\n    // Set the Alias variable 'ws' to it function.\n    ws = (string,...params)=>game.net.ws.send(string, ...params)\n    var wsreset = function() {\n        game.net.ws.conn.addEventListener('close', function() {\n            game.net.StartLocal()\n        })\n        game.net.ws.conn.close()\n    }\n\n}\n\n// ================================================\n// game.net\n// ------------------------------------------------\n\n{\n    game.net = {\n        init() {\n            this.ws = this.ConnectTo(this.DEFAULT_SERVER)\n        },\n\n        // Canonical URL of the game websocket server.\n        DEFAULT_SERVER: new URL('wss://thebachend.com/ws/echo'),\n\n        // Creates a new WebSocketHub using the specified address.\n        ConnectTo(address) {\n            if (window[\"WebSocket\"]) {\n                return new game.classes.net.WebSocketHub(address)\n            } else {\n                throw new Error(`Cannot connect to Websocket at ${address}`)\n            }\n        },\n\n        // NOTE! DEFAULT_LOCAL_SERVER definition is a kludge.\n        // If you don't know what this is doing: remove it. \n        DEFAULT_LOCAL_SERVER: new URL(`ws://${window.location.hostname}:8090/ws/echo`),\n\n        StartLocal() {\n            this.ws = this.ConnectTo(this.DEFAULT_LOCAL_SERVER)\n            game.net.ws.conn.addEventListener('open', function() {\n                ws('add', game.MY_USER)\n                ws('move', game.MY_USER, 2, 8)\n                ws('list')\n            })\n            return this.ws\n        },\n\n    }\n}\n\n// ================================================\n// game.net.HandleMessage\n// ------------------------------------------------\n{\n    // function mapping:  (message.kind) -> (function(message))\n    let funcMap = {\n        'playerlist': handlePlayerList,\n        'UpdateTargets': handleUpdateTargets,\n        'chat': handleChat,\n    }\n\n    // Lookup the function to execute based on the message kind.\n    function HandleIncomingMessage(message) {\n        if (message.kind === undefined) {\n            return\n        }\n        let f = funcMap[message.kind]\n        if (typeof (f) !== 'function') {\n            throw new Error(`message kind not implemented: ${message.kind}`)\n        }\n        f(message)\n    }\n\n    function handlePlayerList(message) {\n        game.player.UpdateList(message.result)\n\n    }\n\n    function handleUpdateTargets(message) {\n        for (let[name,pos] of Object.entries(message.result)) {\n            game.player.list2[name].TargetPos = pos\n        }\n    }\n\n    function handleChat(message) {\n        console.log(message)\n        let {User, Message} = message.result\n\n        // use setText for lasting messages (until you logout).\n        game.player.list.get(User).chatbox.setText(Message)\n\n        // use doMessage for self-clearing messages.\n        // game.player.list.get(User).chatbox.doMessage(Message)\n    }\n\n    game.net.HandleMessage = HandleIncomingMessage\n}\n\n// ================================================\n// Sending chat messages with Chat Form.\n// ------------------------------------------------\n{\n    let chatbar = document.querySelector('#ChatBar')\n    let chatform = document.querySelector('#ChatInputForm')\n\n    function submitChat(event) {\n        if (!chatbar.value) {\n            return false\n        }\n        if (!game.net.ws.conn) {\n            return false\n        }\n        ws('chat', game.MY_USER, chatbar.value)\n        chatbar.value = \"\"\n        chatbar.blur()\n        return false\n    }\n\n    chatform.onsubmit = submitChat\n}\n","// ================================================\n// game.player \n// ------------------------------------------------\n\n{\n    function init() {\n        // game.player.list is the client's local playerlist.\n        this.list = new Map()\n\n        // activeset is used to detect when players have left the area.\n        // when a FullPlayerList message is received, this activelist\n        // gets filled with the player names.  Then, Refresh() is called\n        // to remove any players that aren't in this activelist.\n        this.active = new Set()\n\n        this.me = function() {\n            return game.player.list.get(game.MY_USER)\n        }\n\n    }\n\n    // UpdateList refreshes the playerlist and replaces it with\n    // the list provided by the server.\n    function UpdateList(result) {\n        this.active.clear()\n        for (let[name,p] of Object.entries(result)) {\n\n            // Create a new player object if it hasn't been added yet.\n            if (!this.list.has(name)) {\n                this.list.set(name, game.classes.Player.New(name))\n            }\n            // Retrieve the player object.\n            let play = this.list.get(name)\n\n            // Update the position values\n            {\n                let {X, Y} = p.CurrentPos\n                play.setPos(X, Y)\n            }\n            {\n                let {X, Y} = p.TargetPos\n                play.setTarget(X, Y)\n            }\n            play.Draw()\n\n            // Add the name to the Active set so we don't delete it.\n            this.active.add(name)\n        }\n        this.Refresh()\n    }\n\n    // check for any names that are no longer active.  Remove them\n    // so they don't continue to appear on the screen.\n    function Refresh() {\n        for (let name of this.list.keys()) {\n            if (this.active.has(name)) {\n                this.active.delete(name)\n            } else {\n                this.list.get(name).canvas.remove()\n                this.list.get(name).chatbox.remove()\n                this.list.delete(name)\n\n            }\n        }\n    }\n\n    // Draws all players based on their current positions.\n    function DrawAll() {\n        for ([name,p] of this.list) {\n            p.Draw()\n        }\n        DrawTargetBox()\n    }\n\n    let targetbox = document.querySelector('#myclickbox')\n\n    function DrawTargetBox() {\n        let {X, Y} = game.player.me().TargetPos\n        let {top, left} = game.camera.getTileTopLeft(X, Y)\n        targetbox.style.top = top + 'px'\n        targetbox.style.left = left + 'px'\n    }\n\n    game.player = {\n        init,\n        UpdateList,\n        Refresh,\n        DrawAll,\n        DrawTargetBox,\n    }\n\n}\n\n// ================================================\n// Class Player\n// ------------------------------------------------\n\n{\n    class Player {\n        constructor(canvas, name) {\n            this.name = name\n            this.canvas = canvas\n            this.ctx = canvas.getContext('2d')\n            this.CurrentPos = {\n                X: 1,\n                Y: 1\n            }\n            this.TargetPos = {\n                X: 1,\n                Y: 1\n            }\n            this.chatbox = new game.chat.ChatBox()\n            this.chatbox.setText(this.name)\n        }\n\n        // NewPlayer creates a new canvas for the player at the specified\n        // location, and attaches it to the document body.  The player\n        // object is returned.\n        static New(name) {\n\n            // Creates a new Canvas.\n            let canvas = document.createElement('canvas')\n            let attr = {\n                width: game.TILE_SIZE,\n                height: game.TILE_SIZE,\n                class: 'player',\n            }\n            for (let[key,val] of Object.entries(attr)) {\n                canvas.setAttribute(key, val)\n            }\n            document.querySelector('#WrapPlayerLayer').appendChild(canvas)\n\n            // Creates the player objects and passes it the new canvas.\n            let p = new Player(canvas,name)\n\n            // Add to the player list.\n            game.player.list.set(name, p)\n\n            // Return a reference to the newly created player.\n            return p\n        }\n\n        // setPos force-moves the player to the exact position specified\n        // by directly changing the position both logically and visually.\n        setPos(X, Y) {\n            this.CurrentPos = {\n                X,\n                Y\n            }\n            this.chatbox.setPos(X, Y)\n        }\n\n        // setTarget simply changes the value of the player's target Position.\n        setTarget(X, Y) {\n            this.TargetPos = {\n                X,\n                Y\n            }\n        }\n\n        // Draw doesn't actually re-draw, but it updates it's location\n        // in the CSS, which effectively redraws it.\n        Draw() {\n            let {X, Y} = this.CurrentPos\n            let top = game.TILE_SIZE * (Y - game.camera.FirstTile.y)\n            let left = game.TILE_SIZE * (X - game.camera.FirstTile.x)\n            this.canvas.style.setProperty('top', `${top}px`)\n            this.canvas.style.setProperty('left', `${left}px`)\n        }\n\n        // moveTo sets the target position of the player, and sends a \n        // websocket message to the server, informing the server that\n        // the player wants to move.\n        moveTo(tx, ty) {\n            ws('move', this.name, tx, ty)\n        }\n\n        // Player.scrollTo centers the camera on the tile that the \n        // player is standing on.\n        scrollTo() {\n            let {X, Y} = this.CurrentPos\n            game.camera.scrollToTile(X, Y)\n        }\n    }\n\n    game.classes.Player = Player\n}\n","// ================================================\n// Tiles\n// ------------------------------------------------\n\n{\n    // in future, tile might hold more data than just this.\n    class Tile {\n        constructor(tx, ty) {\n            this.x = tx\n            this.y = ty\n\n            // holds tiletype for each layer.\n            this.layers = {}\n        }\n\n        isEmpty(layername) {\n            return ((this.layers[layername] === 0) || (this.layers[layername] === undefined))\n        }\n\n        getAtlasLocation(layerName) {\n            let val = this.layers[layerName]\n            return {\n                x: ((val - 1) % game.Atlas.ImageCols) * game.Atlas.TileWidth,\n                y: Math.floor((val - 1) / game.Atlas.ImageCols) * game.Atlas.TileHeight\n            }\n        }\n\n        // TODO: \n        // This probably shouldn't be a method of class Tile,\n        // and should instead be a function in game.drawer\n        draw(ctx, layer, px, py) {\n            if (this.isEmpty(layer)) {\n                return\n            }\n            let s = this.getAtlasLocation(layer)\n            ctx.drawImage(game.AtlasImage, s.x, s.y, game.Atlas.TileWidth, game.Atlas.TileHeight, px, py, game.TILE_SIZE, game.TILE_SIZE)\n        }\n    }\n\n    game.classes.Tile = Tile\n}\n","{\n    // Time Bomb is an event that deletes the given element\n    // after the specified amount of milliseconds.\n    function TimeBomb(element, duration) {\n        window.setTimeout(function() {\n            element.remove()\n        }, duration)\n    }\n\n    // helper function for creating new elements.\n    function MakeElement(ElementType, Attributes, Parent) {\n        let ele = document.createElement(ElementType)\n\n        // Iterate through the attributes and add them.\n        if (Attributes !== undefined) {\n            for (let[key,val] of Object.entries(Attributes)) {\n                ele.setAttribute(key, val)\n            }\n        }\n        // Parent can be either an object or a selector string.\n        if (Parent !== undefined) {\n            switch (typeof (Parent)) {\n            case \"object\":\n                Parent.appendChild(ele)\n            case \"string\":\n                document.querySelector(Parent).appendChild(ele)\n            }\n        }\n        return ele\n    }\n\n    game.toolkit = Object.assign({\n        TimeBomb,\n        MakeElement,\n    }, game.toolkit)\n}\n"]}